<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ´»ç®¡ç†ç³»ç»Ÿ - æœ¬åœ°å¼€å‘ç‰ˆ v2.3</title>
    
    <!-- PWAæ”¯æŒ -->
    <link rel="manifest" href="./static/manifest.json">
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç”Ÿæ´»ç®¡ç†">
    <meta name="application-name" content="ç”Ÿæ´»ç®¡ç†ç³»ç»Ÿ">
    <meta name="msapplication-TileColor" content="#007AFF">
    <meta name="msapplication-config" content="./static/browserconfig.xml">
    
    <!-- iOS Safari æ”¯æŒ -->
    <link rel="apple-touch-icon" sizes="180x180" href="./static/icon-192x192.png">
    <link rel="apple-touch-startup-image" href="./static/icon-512x192.png">
    
    <!-- Android Chrome æ”¯æŒ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="default">
    
    <!-- ä¸»é¢˜æ ·å¼ -->
    <link id="theme-stylesheet" rel="stylesheet" href="./static/theme-default.css">
    <!-- ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ -->
    <link rel="stylesheet" href="./static/mobile.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ¯ ç”Ÿæ´»ç®¡ç†ç³»ç»Ÿ <span style="font-size: 14px; color: #666; font-weight: normal;">- Palantir æ¶æ„ v2.3 (æœ¬åœ°å¼€å‘ç‰ˆ)</span></h1>
                <div class="status-indicators">
                    <div class="api-status" id="apiStatus">ğŸ”„ è¿æ¥ä¸­...</div>
                </div>
            </div>
            <div class="header-right">
                <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <div class="theme-switcher">
                    <label class="switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                    <span class="theme-label">ğŸŒ™</span>
                </div>
            </div>
        </div>

        <!-- AI ä»»åŠ¡è¾“å…¥åŒºåŸŸ -->
        <div class="ai-input-section">
            <h2>ğŸ¤– AI åŠ©æ‰‹</h2>
            <div class="input-group">
                <textarea 
                    id="aiInput" 
                    placeholder="æè¿°ä½ çš„éœ€æ±‚ï¼ŒAIå°†ä¸ºä½ ç”Ÿæˆå…·ä½“çš„ä»»åŠ¡æ¸…å•...&#10;ä¾‹å¦‚ï¼šæ˜å¤©è¦å‡†å¤‡è€ƒè¯•ï¼Œéœ€è¦å¤ä¹ æ•°å­¦å’Œè‹±è¯­ï¼Œè¿˜è¦å†™ä¸€ä»½æŠ¥å‘Š"
                    rows="3"
                ></textarea>
                <button onclick="submitToAI()" class="btn btn-primary">
                    <span class="btn-icon">âœ¨</span> ç”Ÿæˆä»»åŠ¡
                </button>
            </div>
        </div>

        <!-- æ‰‹åŠ¨ä»»åŠ¡è¾“å…¥åŒºåŸŸ -->
        <div class="manual-input-section">
            <h2>ğŸ“ æ‰‹åŠ¨æ·»åŠ ä»»åŠ¡</h2>
            <div class="input-group">
                <input 
                    type="text" 
                    id="quickTaskInput" 
                    placeholder="å¿«é€Ÿæ·»åŠ ä»»åŠ¡..."
                    class="quick-task-input"
                    onkeypress="if(event.key==='Enter') addQuickTask()"
                >
                <button onclick="addQuickTask()" class="btn btn-secondary">
                    <span class="btn-icon">â•</span> æ·»åŠ 
                </button>
            </div>
        </div>

        <!-- ä»ªè¡¨æ¿ -->
        <div class="dashboard">
            <div class="time-allocation">
                <h2>â° ä»Šæ—¥æ—¶é—´åˆ†é…ç›®æ ‡</h2>
                <div class="domains-grid">
                    <!-- Academic Domain -->
                    <div class="domain-card academic" data-domain="academic">
                        <div class="domain-header">
                            <h3>ğŸ“š å­¦æœ¯ç ”ç©¶</h3>
                            <button onclick="toggleDomainTasks('academic')" class="toggle-btn">ğŸ‘ï¸</button>
                        </div>
                        <div class="progress-container">
                            <svg class="progress-ring" width="120" height="120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#4285F4" stroke-width="8"
                                        stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                        class="progress-ring-circle" id="academicProgress"/>
                            </svg>
                            <div class="progress-text">
                                <span class="hours">0/6</span>
                                <span class="label">å°æ—¶</span>
                            </div>
                        </div>
                        <div class="domain-tasks" id="academicTasks"></div>
                    </div>

                    <!-- Income Domain -->
                    <div class="domain-card income" data-domain="income">
                        <div class="domain-header">
                            <h3>ğŸ’° æ”¶å…¥å·¥ä½œ</h3>
                            <button onclick="toggleDomainTasks('income')" class="toggle-btn">ğŸ‘ï¸</button>
                        </div>
                        <div class="progress-container">
                            <svg class="progress-ring" width="120" height="120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#34A853" stroke-width="8"
                                        stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                        class="progress-ring-circle" id="incomeProgress"/>
                            </svg>
                            <div class="progress-text">
                                <span class="hours">0/6</span>
                                <span class="label">å°æ—¶</span>
                            </div>
                        </div>
                        <div class="domain-tasks" id="incomeTasks"></div>
                    </div>

                    <!-- Growth Domain -->
                    <div class="domain-card growth" data-domain="growth">
                        <div class="domain-header">
                            <h3>ğŸŒ± ä¸ªäººæˆé•¿</h3>
                            <button onclick="toggleDomainTasks('growth')" class="toggle-btn">ğŸ‘ï¸</button>
                        </div>
                        <div class="progress-container">
                            <svg class="progress-ring" width="120" height="120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#FBBC04" stroke-width="8"
                                        stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                        class="progress-ring-circle" id="growthProgress"/>
                            </svg>
                            <div class="progress-text">
                                <span class="hours">0/4</span>
                                <span class="label">å°æ—¶</span>
                            </div>
                        </div>
                        <div class="domain-tasks" id="growthTasks"></div>
                    </div>

                    <!-- Life Domain -->
                    <div class="domain-card life" data-domain="life">
                        <div class="domain-header">
                            <h3>ğŸ¡ ç”Ÿæ´»äº‹åŠ¡</h3>
                            <button onclick="toggleDomainTasks('life')" class="toggle-btn">ğŸ‘ï¸</button>
                        </div>
                        <div class="progress-container">
                            <svg class="progress-ring" width="120" height="120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#EA4335" stroke-width="8"
                                        stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                        class="progress-ring-circle" id="lifeProgress"/>
                            </svg>
                            <div class="progress-text">
                                <span class="hours">0/4</span>
                                <span class="label">å°æ—¶</span>
                            </div>
                        </div>
                        <div class="domain-tasks" id="lifeTasks"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨ -->
        <div class="tasks-section">
            <div class="section-header">
                <h2>ğŸ“‹ ä»»åŠ¡ç®¡ç†</h2>
                <div class="section-actions">
                    <button onclick="optimizeSchedule()" class="btn btn-optimize">
                        <span class="btn-icon">ğŸ¯</span> AIä¼˜åŒ–æ—¶é—´è¡¨
                    </button>
                </div>
            </div>
            <div id="tasksList" class="tasks-list">
                <!-- ä»»åŠ¡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <div class="fab-container">
        <button class="fab" onclick="document.getElementById('aiInput').focus(); document.getElementById('aiInput').scrollIntoView({behavior: 'smooth'})">
            <span>âœ¨</span>
        </button>
    </div>

    <!-- æ—¶é—´é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
    <div id="timeModal" class="modal">
        <div class="modal-content">
            <h3>â° è®¾ç½®ä»»åŠ¡æ—¶é—´</h3>
            <div class="time-inputs">
                <label>è®¡åˆ’å¼€å§‹æ—¶é—´ï¼š</label>
                <input type="datetime-local" id="scheduledStart">
                <label>è®¡åˆ’ç»“æŸæ—¶é—´ï¼š</label>
                <input type="datetime-local" id="scheduledEnd">
                <label>é¢„ä¼°æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
                <input type="number" id="estimatedMinutes" placeholder="60" min="1">
            </div>
            <div class="modal-actions">
                <button onclick="saveTaskTime()" class="btn btn-primary">ä¿å­˜</button>
                <button onclick="clearTaskTime()" class="btn btn-secondary">æ¸…é™¤</button>
                <button onclick="closeTimeSelector()" class="btn btn-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- PWA å®‰è£…æ¨ªå¹… -->
    <div id="pwa-banner" class="pwa-banner" style="display: none;">
        <span>ğŸš€ å®‰è£…ç”Ÿæ´»ç®¡ç†ç³»ç»Ÿåˆ°æ‚¨çš„è®¾å¤‡</span>
        <div class="pwa-banner-actions">
            <button id="pwa-install-btn" class="btn btn-primary">å®‰è£…</button>
            <button id="pwa-dismiss-btn" class="btn btn-secondary">ç¨å</button>
        </div>
    </div>

    <script src="./static/app.js?v=20250825-local"></script>
    
    <!-- PWAæ”¯æŒè„šæœ¬ -->
    <script>
        // Service Worker æ³¨å†Œ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA å®‰è£…æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('pwa-banner').style.display = 'flex';
        });

        document.getElementById('pwa-install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`ç”¨æˆ·é€‰æ‹©äº†: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('pwa-banner').style.display = 'none';
            }
        });

        document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
            document.getElementById('pwa-banner').style.display = 'none';
        });

        // ç½‘ç»œçŠ¶æ€ç›‘æ§
        window.addEventListener('online', () => {
            console.log('ç½‘ç»œå·²è¿æ¥');
            location.reload();
        });

        window.addEventListener('offline', () => {
            console.log('ç½‘ç»œå·²æ–­å¼€');
        });

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('themeToggle');
        const themeStylesheet = document.getElementById('theme-stylesheet');
        const themeLabel = document.querySelector('.theme-label');

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜è®¾ç½®
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            themeToggle.checked = true;
            themeStylesheet.href = './static/theme-dark.css';
            themeLabel.textContent = 'â˜€ï¸';
        }

        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                themeStylesheet.href = './static/theme-dark.css';
                themeLabel.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'dark');
            } else {
                themeStylesheet.href = './static/theme-default.css';
                themeLabel.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'light');
            }
        });
    </script>
</body>
</html>